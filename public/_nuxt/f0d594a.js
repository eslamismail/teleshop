(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{327:function(t,e,r){"use strict";var o={props:{error:{type:String,required:!0}}},n=r(16),component=Object(n.a)(o,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"m-1"},[e("span",{staticClass:"text-danger"},[this._v(this._s(this.error))])])}),[],!1,null,null,null);e.a=component.exports},330:function(t,e,r){var content=r(343);"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(49).default)("301fbe76",content,!0,{sourceMap:!1})},342:function(t,e,r){"use strict";var o=r(330);r.n(o).a},343:function(t,e,r){(e=r(48)(!1)).push([t.i,"img[data-v-78b5a162]{width:10%}",""]),t.exports=e},345:function(t,e,r){"use strict";r.r(e);r(23);var o=r(3),n=(r(335),r(0)),c={props:{room:{type:Object,required:!0},active:{type:Boolean,default:!1}},data:function(){return{created_at:null,interval:null}},mounted:function(){this.solveDate()},updated:function(){this.solveDate()},methods:{solveDate:function(){var t=this;this.interval=setInterval((function(){var e=n(new Date),r=n(t.room.message_send_at),o=n.duration(e.diff(r)).asHours();o<=1?t.created_at="About "+n(t.room.message_send_at).fromNow():o<=168?t.created_at=n(t.room.message_send_at).calendar():(t.created_at=n(t.room.message_send_at).format("YYYY MMM DD | hh:mm:ss a"),clearInterval(t.interval))}),100)},setActive:function(){this.$emit("active","".concat(this.room.id))}}},l=r(16),m=Object(l.a)(c,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{class:"chat_list "+(t.active?"active_chat":""),attrs:{id:"chat_list_"+t.room.id},on:{click:function(e){return e.preventDefault(),t.setActive()}}},[r("div",{staticClass:"chat_people"},[r("div",{staticClass:"chat_img"},[t.room.room_image?r("img",{staticStyle:{"border-radius":"50%"},attrs:{src:t.room.room_image,alt:"sunil"}}):t._e()]),t._v(" "),r("div",{staticClass:"chat_ib"},[r("h5",[t._v("\n        "+t._s(t.room.room_name)+"\n        "),r("span",{staticClass:"chat_date"},[t._v(t._s(t.created_at))])]),t._v(" "),r("p",[t._v(t._s(t.room.last_message&&t.room.last_message.length>45?t.room.last_message.substr(0,45)+".....":t.room.last_message))])])])])}),[],!1,null,null,null).exports,d=r(0),f={props:{message:{type:Object,required:!0}},data:function(){return{created_at:null,interval:null}},beforeMount:function(){this.solveDate()},mounted:function(){var t=this,e=document.getElementById("msg_history"),r=setInterval((function(){e&&t.created_at&&(e.scrollTop=e.scrollHeight,clearInterval(r))}),100)},methods:{solveDate:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.interval=setInterval((function(){var e=d(new Date),r=d(t.message.created_at),o=d.duration(e.diff(r)).asHours();o<=1?t.created_at="About "+d(t.message.created_at).fromNow():o<=168?t.created_at=d(t.message.created_at).calendar():(t.created_at=d(t.message.created_at).format("YYYY MMM DD | hh:mm:ss a"),clearInterval(t.interval))}),100);case 1:case"end":return e.stop()}}),e)})))()}},computed:{user:function(){return this.$store.state.login.user}}},_=Object(l.a)(f,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.user&&t.message.sender_id!=t.user.id?r("div",{staticClass:"incoming_msg"},[t.message.sender?r("div",{staticClass:"incoming_msg_img"},[r("img",{staticStyle:{"border-radius":"50%"},attrs:{src:t.message.sender.profile_picture_url,alt:"sunil"}})]):t._e(),t._v(" "),r("div",{staticClass:"received_msg"},[r("div",{staticClass:"received_withd_msg"},[r("p",[t._v(t._s(t.message.message))]),t._v(" "),t._l(t.message.images_url,(function(t,e){return r("img",{key:e,attrs:{src:t}})})),t._v(" "),r("span",{staticClass:"time_date"},[t._v(t._s(t.created_at))])],2)])]):r("div",{staticClass:"outgoing_msg"},[r("div",{staticClass:"sent_msg"},[r("p",[t._v(t._s(t.message.message))]),t._v(" "),t._l(t.message.images_url,(function(t,e){return r("img",{key:e,attrs:{src:t}})})),t._v(" "),r("span",{staticClass:"time_date"},[t._v(t._s(t.created_at))])],2)])}),[],!1,null,null,null).exports,v=(r(339),{components:{Error:r(327).a},props:{roomID:{type:Number,required:!0}},data:function(){return{errors:{message:[]}}},computed:{user:function(){return this.$store.state.login.user}},methods:{typing:function(){Echo.private("chat-".concat(this.roomID)).whisper("typing",{user:this.user})},sendMessage:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var form,r,o,n,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return form=new FormData(event.target),e.prev=1,e.next=4,axios.post("/rooms/".concat(t.roomID,"/message"),form);case 4:t.errors={message:[]},e.next=11;break;case 7:e.prev=7,e.t0=e.catch(1),console.log("error",e.t0),e.t0.response?422==e.t0.response.status?(t.errors=e.t0.response.data.errors,r=e.t0.response.data.message,t.$notify({group:"foo",text:r,type:"error"})):401==e.t0.response.status?(o=e.t0.response.data.message,t.$notify({group:"foo",text:o,type:"error"}),$nuxt.$store.commit("login/logout",{})):400==e.t0.response.status?(n=e.t0.response.data.message,t.$notify({group:"foo",text:n,type:"error"})):(c=e.t0.response.data.statusText,t.$notify({group:"foo",text:c,type:"error"})):t.$notify({group:"foo",text:"No internet access",type:"error"});case 11:case"end":return e.stop()}}),e,null,[[1,7]])})))()}}}),h=Object(l.a)(v,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"type_msg"},[r("div",{staticClass:"input_msg_write"},[r("form",{on:{submit:function(e){return e.preventDefault(),t.sendMessage(e)}}},[r("input",{staticClass:"write_msg",attrs:{type:"text",placeholder:"Type a message",name:"message",autocomplete:"off"},on:{keypress:t.typing}}),t._v(" "),r("input",{attrs:{type:"file",name:"image"}}),t._v(" "),t._m(0)]),t._v(" "),t._l(t.errors.message,(function(t,e){return r("error",{key:e,attrs:{error:t}})}))],2)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("button",{staticClass:"msg_send_btn",attrs:{type:"submit"}},[e("i",{staticClass:"fa fa-paper-plane-o",attrs:{"aria-hidden":"true"}})])}],!1,null,null,null).exports,y={props:{users:Array,required:!0},data:function(){return{img:"https://cdn1.vectorstock.com/i/1000x1000/51/05/male-profile-avatar-with-brown-hair-vector-12055105.jpg"}},mounted:function(){},methods:{selectUser:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var o,n,c,l,m,d;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,axios.post("/rooms/create",{user_id:t});case 3:o=r.sent,n=o.data.message,e.$notify({group:"foo",text:"".concat(n),type:"success"}),$("#exampleModal").modal("hide"),r.next=12;break;case 9:r.prev=9,r.t0=r.catch(0),r.t0.response?400==r.t0.response.status?(c=r.t0.response.data.message,e.$notify({group:"foo",text:"".concat(c),type:"error"})):422==r.t0.response.status?(l=r.t0.response.data.message,e.$notify({group:"foo",text:"".concat(l),type:"error"}),m=r.t0.response.data.errors.user_id,e.$notify({group:"foo",text:"".concat(m),type:"error"})):(d=r.t0.response.data.message,e.$notify({group:"foo",text:"".concat(d),type:"error"})):e.$notify({group:"foo",text:"no internet access",type:"error"});case 12:case"end":return r.stop()}}),r,null,[[0,9]])})))()}}},x=(r(342),{components:{Modal:Object(l.a)(y,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"modal fade",staticStyle:{"z-index":"1000000"},attrs:{id:"exampleModal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"}},[r("div",{staticClass:"modal-dialog"},[r("div",{staticClass:"modal-content"},[t._m(0),t._v(" "),r("div",{staticClass:"modal-body"},[r("div",{staticClass:"card text-left"},[r("ul",{staticClass:"list-group list-group-flush"},t._l(t.users,(function(e,o){return r("li",{key:o,staticClass:"list-group-item justify-content-between d-flex align-items-center",on:{click:function(r){return r.preventDefault(),t.selectUser(e.id)}}},[r("label",{attrs:{for:"user-"+e.id}},[r("img",{staticClass:"mr-2 rounded img-thumbnail",attrs:{src:t.img,width:"30%",alt:""}}),t._v("\n                "+t._s(e.full_name)+"\n              ")])])})),0)])])])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title",attrs:{id:"exampleModalLabel"}},[this._v("Create new Chat")]),this._v(" "),e("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[e("span",{attrs:{"aria-hidden":"true"}},[this._v("Ã—")])])])}],!1,null,"78b5a162",null).exports},data:function(){return{users:[]}},methods:{addUser:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,axios.get("users");case 3:r=e.sent,t.users=r.data.users,t.users.length>0?$("#exampleModal").modal("show"):t.$notify({group:"foo",text:"no members to show",type:"error"}),e.next=10;break;case 8:e.prev=8,e.t0=e.catch(0);case 10:case"end":return e.stop()}}),e,null,[[0,8]])})))()}}}),C=Object(l.a)(x,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("button",{staticClass:"btn btn-default",on:{click:function(e){return e.preventDefault(),t.addUser()}}},[t._v("+")]),t._v(" "),r("modal",{attrs:{users:t.users}})],1)}),[],!1,null,null,null).exports,w=r(344),k=r(0),D={middleware:"auth",components:{chatList:m,incomming:_,sendMessage:h,AddUser:C},data:function(){return{rooms:[],typing:"",messages:[],room:null,lastRoom:null}},head:function(){return{link:[{href:"/css/chat.css",rel:"StyleSheet"},{href:"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css",rel:"StyleSheet"}]}},computed:{user:function(){return this.$store.state.login.user}},created:function(){var t=this;Echo.private("room-".concat(this.user.id)).listen("NewRoom",(function(e){t.rooms.unshift(e.room)})).listen("RoomUpdated",(function(e){t.rooms.forEach((function(t){t.id==e.room.id&&(t.message_send_at=e.room.message_send_at,t.last_message=e.room.last_message)})),t.rooms=w.sortBy(t.rooms,(function(t){return-k(t.message_send_at).valueOf()}))}))},mounted:function(){this.getRooms()},methods:{scrollDown:function(){var t=document.getElementById("msg_history"),e=setInterval((function(){t&&(t.scrollTop=t.scrollHeight,clearInterval(e))}),100)},setActive:function(t){if(this.room&&this.leavePrivate(this.room.id),this.scrollDown(),this.room=this.rooms.find((function(e){return e.id==t})),this.selectedRoom=!0,this.messages.length>0&&this.messages[0].room_id==this.room.id||this.lastRoom==this.room.id)return this.openSocket(t),!1;this.getMessages(t),this.lastRoom=t,this.openSocket(t)},openSocket:function(t){var e=this;Echo.private("chat-".concat(t)).listenForWhisper("typing",(function(t){e.user.id!=t.user.id&&(e.typing="".concat(t.user.full_name," typing....."),setTimeout((function(){e.typing=""}),3e3))})).listen("NewMessage",(function(t){e.messages.push(t.message),e.rooms=w.sortBy(e.rooms,(function(t){return-k(t.message_send_at).valueOf()}))}))},leavePrivate:function(t){Echo.leave("chat-".concat(t))},getMessages:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var o,n,c;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,axios.get("/rooms/".concat(t));case 3:o=r.sent,e.messages=o.data.messages,r.next=10;break;case 7:r.prev=7,r.t0=r.catch(0),r.t0.response?401==r.t0.response.status?(n=r.t0.response.data.message,e.$notify({group:"foo",text:n,type:"error"}),$nuxt.$store.commit("login/logout",{})):(c=r.t0.response.data.message,e.$notify({group:"foo",text:c,type:"error"})):e.$notify({group:"foo",text:"No internet access",type:"error"});case 10:case"end":return r.stop()}}),r,null,[[0,7]])})))()},getRooms:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,o,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,axios.get("/rooms");case 3:r=e.sent,t.rooms=w.sortBy(r.data.rooms,(function(t){return-k(t.message_send_at).valueOf()})),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0),e.t0.response?401==e.t0.response.status?(o=e.t0.response.data.message,t.$notify({group:"foo",text:o,type:"error"}),$nuxt.$store.commit("login/logout",{})):(n=e.t0.response.data.message,t.$notify({group:"foo",text:n,type:"error"})):t.$notify({group:"foo",text:"No internet access",type:"error"});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))()}}},j=Object(l.a)(D,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"container h-100"},[r("div",{staticClass:"messaging"},[r("div",{staticClass:"inbox_msg"},[r("div",{staticClass:"inbox_people"},[r("div",{staticClass:"headind_srch"},[r("div",{staticClass:"recent_heading"},[t.user?r("h4",[r("img",{staticStyle:{"border-radius":"50%","max-width":"11%"},attrs:{src:t.user.profile_picture_url,alt:""}}),t._v("\n                "+t._s(t.user.full_name)+"\n              ")]):t._e()]),t._v(" "),r("div",{staticClass:"srch_bar"},[r("div",{staticClass:"stylish-input-group"},[r("add-user")],1)])]),t._v(" "),r("div",{staticClass:"inbox_chat"},t._l(t.rooms,(function(e,o){return r("chat-list",{key:o,attrs:{room:e,active:!(!t.room||t.room.id!=e.id)},on:{active:t.setActive}})})),1)]),t._v(" "),r("div",{staticClass:"mesgs"},[t.messages.length>0?r("div",[r("div",{staticClass:"msg_history",attrs:{id:"msg_history"}},t._l(t.messages,(function(t,e){return r("incomming",{key:e,attrs:{message:t}})})),1)]):0==t.messages.length&&null!=t.room?r("div",{staticClass:"msg_history align-items-center d-flex"},[t._m(0)]):r("div",{staticClass:"msg_history align-items-center d-flex"},[t._m(1)]),t._v(" "),r("div",{staticClass:"typing"},[t._v(t._s(t.typing))]),t._v(" "),t.room?r("send-message",{attrs:{roomID:t.room.id}}):t._e()],1)])])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"col-12 text-center"},[e("img",{attrs:{src:"https://scontent.fcai20-2.fna.fbcdn.net/v/t1.0-9/25956_505071682877248_1469610775_n.jpg?_nc_cat=100&_nc_sid=09cbfe&_nc_ohc=GMrvtZ6vaMQAX9jxODH&_nc_ht=scontent.fcai20-2.fna&oh=7d6a1a623fc2127aab96d6a80ec9ac8d&oe=5F93421E",alt:""}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"col-12 text-center"},[e("img",{attrs:{width:"30%",src:"https://previews.123rf.com/images/get4net/get4net1812/get4net181200729/127169830-empty-inbox-tray.jpg",alt:""}})])}],!1,null,null,null);e.default=j.exports}}]);