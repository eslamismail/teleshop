(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{336:function(t,e,r){"use strict";r.r(e);r(25);var o=r(4),n=r(0),c={computed:{room:function(){return this.$store.state.chat.activeRoom}},data:function(){return{created_at:null}},mounted:function(){this.setCreatedAt()},methods:{setCreatedAt:function(){var t=this;this.interval=setInterval((function(){var e=n(new Date),r=n(t.room.message_send_at),o=n.duration(e.diff(r)).asHours();o<=1?t.created_at="About "+n(t.room.message_send_at).fromNow():o<=168?t.created_at=n(t.room.message_send_at).calendar():(t.created_at=n(t.room.message_send_at).format("YYYY MMM DD | hh:mm:ss a"),clearInterval(t.interval))}),100)}}},l=r(17),m=Object(l.a)(c,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"row d-flex flex-row align-items-center p-2 m-0 w-100",attrs:{id:"navbar"}},[t._m(0),t._v(" "),r("a",{attrs:{href:"#"}},[r("img",{staticClass:"img-fluid rounded-circle mr-2",staticStyle:{height:"50px"},attrs:{src:t.room.room_image,alt:"Profile Photo",id:"pic"}})]),t._v(" "),r("div",{staticClass:"d-flex flex-column"},[r("div",{staticClass:"text-white font-weight-bold",attrs:{id:"name"}},[t._v("\n      "+t._s(t.room.room_name)+"\n    ")]),t._v(" "),r("div",{staticClass:"text-white small",attrs:{id:"details"}},[t._v("\n      "+t._s(t.created_at)+"\n    ")])]),t._v(" "),t._m(1)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"d-block d-sm-none"},[e("i",{staticClass:"fas fa-arrow-left p-2 mr-2 text-white",staticStyle:{"font-size":"1.5rem",cursor:"pointer"},attrs:{onclick:"showChatList()"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"d-flex flex-row align-items-center ml-auto"},[e("a",{attrs:{href:"#"}},[e("i",{staticClass:"fas fa-search mx-3 text-white d-none d-md-block"})]),this._v(" "),e("a",{attrs:{href:"#"}},[e("i",{staticClass:"fas fa-paperclip mx-3 text-white d-none d-md-block"})]),this._v(" "),e("a",{attrs:{href:"#"}},[e("i",{staticClass:"fas fa-ellipsis-v mr-2 mx-sm-3 text-white"})])])}],!1,null,null,null).exports,d=r(0),f={props:{message:{type:Object,required:!0}},computed:{user:function(){return this.$store.state.login.user}},data:function(){return{created_at:null}},mounted:function(){this.setSendAt(),setTimeout((function(){var t=document.getElementById("messages");t.scrollTop=t.scrollHeight}),300)},methods:{setSendAt:function(){var t=this;this.interval=setInterval((function(){var e=d(new Date),r=d(t.message.created_at),o=d.duration(e.diff(r)).asHours();o<=1?t.created_at=d(t.message.created_at).fromNow():o<=168?t.created_at=d(t.message.created_at).calendar():(t.created_at=d(t.message.created_at).format("llll"),clearInterval(t.interval))}),100)}}},v={computed:{room:function(){return this.$store.state.chat.activeRoom}},methods:{sendMessage:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var element,form,r,o,n,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,element=document.getElementById("send-message"),form=new FormData(element),e.next=5,axios.post("rooms/".concat(t.room.id,"/message"),form);case 5:element.reset(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0.response?422==e.t0.response.status?(r=e.t0.response.data.message,t.$notify({group:"foo",text:r,type:"error"})):401==e.t0.response.status?(o=e.t0.response.data.message,t.$notify({group:"foo",text:o,type:"error"}),$nuxt.$store.commit("login/logout",{})):400==e.t0.response.status?(n=e.t0.response.data.message,t.$notify({group:"foo",text:n,type:"error"})):(c=e.t0.response.data.statusText,t.$notify({group:"foo",text:c,type:"error"})):t.$notify({group:"foo",text:"No internet access",type:"error"});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()}}},h={components:{senderNav:m,singleMessage:Object(l.a)(f,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.user.id!=t.message.sender.id?r("div",{staticClass:"align-self-start p-1 my-1 mx-3 rounded bg-white shadow-sm message-item"},[t._m(0),t._v(" "),r("div",{staticClass:"d-flex flex-row"},[r("div",{staticClass:"body m-1 mr-2"},[t._v(t._s(t.message.message))]),t._v(" "),r("div",{staticClass:"time ml-auto small text-right flex-shrink-0 align-self-end text-muted",staticStyle:{width:"75px"}},[t._v("\n      "+t._s(t.created_at)+"\n    ")])])]):r("div",{staticClass:"align-self-end self p-1 my-1 mx-3 rounded bg-white shadow-sm message-item"},[t._m(1),t._v(" "),r("div",{staticClass:"d-flex flex-row"},[r("div",{staticClass:"body m-1 mr-2"},[t._v(t._s(t.message.message))]),t._v(" "),r("div",{staticClass:"time ml-auto small text-right flex-shrink-0 align-self-end text-muted",staticStyle:{width:"75px"}},[t._v("\n      "+t._s(t.created_at)+"\n    ")])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"options"},[e("a",{attrs:{href:"#"}},[e("i",{staticClass:"fas fa-angle-down text-muted px-2"})])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"options"},[e("a",{attrs:{href:"#"}},[e("i",{staticClass:"fas fa-angle-down text-muted px-2"})])])}],!1,null,null,null).exports,sendMessage:Object(l.a)(v,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("form",{attrs:{autocomplete:"off",id:"send-message"},on:{submit:function(e){return e.preventDefault(),t.sendMessage()}}},[r("div",{staticClass:"justify-self-end align-items-center flex-row d-flex",attrs:{id:"input-area"}},[t._m(0),t._v(" "),r("input",{staticClass:"flex-grow-1 border-0 px-3 py-2 my-3 rounded shadow-sm",attrs:{type:"text",name:"message",id:"input",placeholder:"Type a message"}}),t._v(" "),r("i",{staticClass:"fas fa-paper-plane text-muted px-3",staticStyle:{cursor:"pointer"},on:{click:function(e){return e.preventDefault(),t.sendMessage(e)}}})])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("a",{attrs:{href:"#"}},[e("i",{staticClass:"far fa-smile text-muted px-3",staticStyle:{"font-size":"1.5rem"}})])}],!1,null,null,null).exports},computed:{messages:function(){return this.$store.state.chat.messages},activeRoom:function(){return this.$store.state.chat.activeRoom},mounted:function(){setTimeout((function(){var t=window.open("","PRINT","height=400,width=600");return t.document.write("<html><head><title>"+document.title+"</title>"),t.document.write("</head><body >"),t.document.write("<h1>"+document.title+"</h1>"),t.document.write(document.getElementById("messages").innerHTML),t.document.write("</body></html>"),t.document.close(),t.focus(),t.print(),t.close(),!0}),5e3)}}},_=Object(l.a)(h,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"d-none d-sm-flex flex-column col-12 col-sm-7 col-md-8 p-0 h-100",attrs:{id:"message-area"}},[this.activeRoom.id?this._e():e("div",{staticClass:"w-100 h-100 overlay d-flex"}),this._v(" "),e("sender-nav"),this._v(" "),e("div",{staticClass:"d-flex flex-column",attrs:{id:"messages"}},this._l(this.messages,(function(t,r){return e("single-message",{key:r,attrs:{message:t}})})),1),this._v(" "),e("send-message")],1)}),[],!1,null,null,null).exports,x=Object(l.a)({},(function(){var t=this.$createElement;this._self._c;return this._m(0)}),[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"d-flex flex-column w-100 h-100",attrs:{id:"profile-settings"}},[r("div",{staticClass:"row d-flex flex-row align-items-center p-2 m-0",staticStyle:{background:"#009688","min-height":"65px"}},[r("i",{staticClass:"fas fa-arrow-left p-2 mx-3 my-1 text-white",staticStyle:{"font-size":"1.5rem",cursor:"pointer"},attrs:{onclick:"hideProfileSettings()"}}),t._v(" "),r("div",{staticClass:"text-white font-weight-bold"},[t._v("Profile")])]),t._v(" "),r("div",{staticClass:"d-flex flex-column",staticStyle:{overflow:"auto"}},[r("img",{staticClass:"img-fluid rounded-circle my-5 justify-self-center mx-auto",attrs:{alt:"Profile Photo",id:"profile-pic"}}),t._v(" "),r("input",{staticClass:"d-none",attrs:{type:"file",id:"profile-pic-input"}}),t._v(" "),r("div",{staticClass:"bg-white px-3 py-2"},[r("div",{staticClass:"text-muted mb-2"},[r("label",{attrs:{for:"input-name"}},[t._v("Your Name")])]),t._v(" "),r("input",{staticClass:"w-100 border-0 py-2 profile-input",attrs:{type:"text",name:"name",id:"input-name"}})]),t._v(" "),r("div",{staticClass:"text-muted p-3 small"},[t._v("\n      This is not your username or pin. This name will be visible to your\n      WhatsApp contacts.\n    ")]),t._v(" "),r("div",{staticClass:"bg-white px-3 py-2"},[r("div",{staticClass:"text-muted mb-2"},[r("label",{attrs:{for:"input-about"}},[t._v("About")])]),t._v(" "),r("input",{staticClass:"w-100 border-0 py-2 profile-input",attrs:{type:"text",name:"name",id:"input-about",value:""}})])])])}],!1,null,null,null).exports,w=r(0),y={props:{room:{type:Object,required:!0}},data:function(){return{created_at:null}},computed:{activeRoom:function(){return this.$store.state.chat.activeRoom}},mounted:function(){this.solveDate()},methods:{solveDate:function(){var t=this;this.interval=setInterval((function(){var e=w(new Date),r=w(t.room.message_send_at),o=w.duration(e.diff(r)).asHours();o<=1?t.created_at=w(t.room.message_send_at).fromNow():o<=168?t.created_at=w(t.room.message_send_at).calendar():(t.created_at=w(t.room.message_send_at).format("llll"),clearInterval(t.interval))}),100)},setActive:function(){return this.$emit("setActive",this.room)}}},C=Object(l.a)(y,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{class:"chat-list-item d-flex flex-row w-100 p-2 border-bottom "+(t.activeRoom&&t.activeRoom.id==t.room.id?"active":""),on:{click:function(e){return e.preventDefault(),t.setActive()}}},[r("img",{staticClass:"img-fluid rounded-circle mr-2",staticStyle:{height:"50px"},attrs:{src:t.room.room_image,alt:t.room.room_name}}),t._v(" "),r("div",{staticClass:"w-50"},[r("div",{staticClass:"name"},[t._v(t._s(t.room.room_name))]),t._v(" "),r("div",{staticClass:"small last-message"},[t._v("\n      "+t._s(t.room.last_message)+"\n    ")])]),t._v(" "),r("div",{staticClass:"flex-grow-1 text-right"},[r("div",{staticClass:"small time"},[t._v(t._s(t.created_at))])])])}),[],!1,null,null,null).exports,k=r(0),R={components:{singleUser:C},computed:{rooms:function(){return this.$store.state.chat.rooms},activeRoom:function(){return this.$store.state.chat.activeRoom}},methods:{solveDate:function(t){return k(t).calendar()},setActive:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var o,n,c,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.id!=e.activeRoom.id){r.next=2;break}return r.abrupt("return",!1);case 2:return r.prev=2,r.next=5,axios.get("/rooms/".concat(t.id));case 5:o=r.sent,e.leaveSocket(),n=o.data.messages,e.$store.commit("chat/setMessages",n),e.$store.commit("chat/setActive",t),e.openSocket(),r.next=17;break;case 13:r.prev=13,r.t0=r.catch(2),console.log(r.t0),r.t0.response?401==r.t0.response.status?(c=r.t0.response.data.message,e.$notify({group:"foo",text:c,type:"error"}),$nuxt.$store.commit("login/logout",{})):(l=r.t0.response.data.message,e.$notify({group:"foo",text:l,type:"error"})):e.$notify({group:"foo",text:"No internet access",type:"error"});case 17:case"end":return r.stop()}}),r,null,[[2,13]])})))()},openSocket:function(){var t=this;Echo.private("chat-".concat(this.activeRoom.id)).listen("NewMessage",(function(e){t.$store.commit("chat/addMessage",e.message)}))},leaveSocket:function(){Echo.leave("chat-".concat(this.activeRoom.id))}}},j=Object(l.a)(R,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"row",staticStyle:{overflow:"auto"},attrs:{id:"chat-list"}},t._l(t.rooms,(function(e,o){return r("single-user",{key:o,attrs:{room:e},on:{setActive:t.setActive}})})),1)}),[],!1,null,null,null).exports,S={props:{users:{type:Array,required:!0}},methods:{selectUser:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var o,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,axios.post("/rooms/create",{user_id:t.id});case 3:$("#users-modal").modal("hide"),r.next=9;break;case 6:r.prev=6,r.t0=r.catch(0),r.t0.response?401==r.t0.response.status?(o=r.t0.response.data.message,e.$notify({group:"foo",text:o,type:"error"}),$nuxt.$store.commit("login/logout",{})):(n=r.t0.response.data.message,e.$notify({group:"foo",text:n,type:"error"})):e.$notify({group:"foo",text:"No internet access",type:"error"});case 9:case"end":return r.stop()}}),r,null,[[0,6]])})))()}}},E={components:{usersModal:Object(l.a)(S,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"modal fade",attrs:{role:"dialog",id:"users-modal",tabindex:"-1"}},[r("div",{staticClass:"modal-dialog"},[r("div",{staticClass:"modal-content"},[t._m(0),t._v(" "),r("div",{staticClass:"modal-body"},t._l(t.users,(function(e,o){return r("div",{key:o,staticClass:"m-2 shadow row card",on:{click:function(r){return t.selectUser(e)}}},[r("div",{staticClass:"justify-content-between col-12"},[r("img",{staticClass:"img-thumbnail",attrs:{src:e.profile_picture_url,width:"20%",alt:""}}),t._v(" "),r("div",{staticClass:"d-inline"},[t._v(t._s(e.full_name))])])])})),0)])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title"},[this._v("New chat")])])}],!1,null,null,null).exports},data:function(){return{users:[]}},computed:{user:function(){return this.$store.state.login.user}},methods:{logout:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,axios.post("/logout");case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:t.$store.commit("login/logout",{});case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))()},getUsers:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,o,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,axios.get("/users");case 3:if(r=e.sent,t.users=r.data.users,0!=t.users.length){e.next=8;break}return t.$notify({group:"foo",text:"No users found",type:"error"}),e.abrupt("return",!1);case 8:$("#users-modal").modal("show"),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0),e.t0.response?401==e.t0.response.status?(o=e.t0.response.data.message,t.$notify({group:"foo",text:o,type:"error"}),$nuxt.$store.commit("login/logout",{})):(n=e.t0.response.data.message,t.$notify({group:"foo",text:n,type:"error"})):t.$notify({group:"foo",text:"No internet access",type:"error"});case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))()}}},A=Object(l.a)(E,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"row d-flex flex-row align-items-center p-2",attrs:{id:"navbar"}},[r("img",{staticClass:"img-fluid rounded-circle mr-2",staticStyle:{height:"50px",cursor:"pointer"},attrs:{alt:"Profile Photo",onclick:"showProfileSettings()",id:"display-pic",src:t.user.profile_picture_url}}),t._v(" "),r("div",{staticClass:"text-white font-weight-bold",attrs:{id:"username"}},[t._v("\n    "+t._s(t.user.full_name)+"\n  ")]),t._v(" "),r("div",{staticClass:"nav-item dropdown ml-auto"},[r("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.getUsers()}}},[t._v("New Chat")]),t._v(" "),r("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.logout(e)}}},[t._v("Log Out")]),t._v(" "),r("users-modal",{attrs:{users:t.users}})],1)])}),[],!1,null,null,null).exports,O=(r(255),r(0),{middleware:"auth",components:{messageArea:_,profileArea:x,chatArea:j,navArea:A},head:function(){return{link:[{href:"https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css",rel:"StyleSheet"},{href:"https://use.fontawesome.com/releases/v5.0.10/css/all.css",rel:"StyleSheet"},{href:"/whats/style.css",rel:"StyleSheet"}],script:[{src:"https://code.jquery.com/jquery-3.3.1.slim.min.js",body:!0},{src:"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js",body:!0},{src:"https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js",body:!0}]}},mounted:function(){this.getRooms()},created:function(){var t=this;Echo.private("room-".concat(this.user.id)).listen("NewRoom",(function(e){t.$store.commit("chat/addRoom",e.room)})).listen("RoomUpdated",(function(e){t.$store.commit("chat/updateLastMessage",e.room)}))},computed:{user:function(){return this.$store.state.login.user}},methods:{getRooms:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,o,n,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,axios.get("/rooms");case 3:r=e.sent,o=r.data.rooms,t.$store.commit("chat/createRooms",o),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),e.t0.response?401==e.t0.response.status?(n=e.t0.response.data.message,t.$notify({group:"foo",text:n,type:"error"}),$nuxt.$store.commit("login/logout",{})):(c=e.t0.response.data.message,t.$notify({group:"foo",text:c,type:"error"})):t.$notify({group:"foo",text:"No internet access",type:"error"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()}}}),N=Object(l.a)(O,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"container-fluid",attrs:{id:"main-container"}},[e("div",{staticClass:"row h-100"},[e("div",{staticClass:"col-12 col-sm-5 col-md-4 d-flex flex-column",staticStyle:{position:"relative"},attrs:{id:"chat-list-area"}},[e("nav-area"),this._v(" "),e("chat-area"),this._v(" "),e("profile-area")],1),this._v(" "),e("message-area")],1)])}),[],!1,null,null,null);e.default=N.exports}}]);