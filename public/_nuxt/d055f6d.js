(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{337:function(t,e,r){"use strict";r.r(e);r(25);var o=r(4),n=r(0),c={computed:{room:function(){return this.$store.state.chat.activeRoom},typing:function(){return this.$store.state.chat.typing}},data:function(){return{created_at:null}},mounted:function(){this.setCreatedAt()},methods:{setCreatedAt:function(){var t=this;this.interval=setInterval((function(){var e=n(new Date),r=n(t.room.message_send_at),o=n.duration(e.diff(r)).asHours();o<=1?t.created_at="About "+n(t.room.message_send_at).fromNow():o<=168?t.created_at=n(t.room.message_send_at).calendar():(t.created_at=n(t.room.message_send_at).format("YYYY MMM DD | hh:mm:ss a"),clearInterval(t.interval))}),100)},exitRoom:function(){Echo.leave("chat-".concat(this.room.id)),this.$store.commit("chat/setActive",{})}}},l=r(17),m=Object(l.a)(c,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"row d-flex flex-row align-items-center p-2 m-0 w-100",attrs:{id:"navbar"}},[t._m(0),t._v(" "),r("a",{attrs:{href:"#"}},[r("img",{staticClass:"img-fluid rounded-circle mr-2",staticStyle:{height:"50px"},attrs:{src:t.room.room_image,alt:"Profile Photo",id:"pic"}})]),t._v(" "),r("div",{staticClass:"d-flex flex-column"},[r("div",{staticClass:"text-white font-weight-bold",attrs:{id:"name"}},[t._v("\n      "+t._s(t.room.room_name)+"\n    ")]),t._v(" "),r("div",{staticClass:"text-white small",attrs:{id:"details"}},[t._v("\n      "+t._s(t.typing?t.typing:t.created_at)+"\n    ")])]),t._v(" "),r("div",{staticClass:"d-flex flex-row align-items-center ml-auto"},[t._m(1),t._v(" "),t._m(2),t._v(" "),t._m(3),t._v(" "),r("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.exitRoom()}}},[r("i",{staticClass:"fas fa-times mr-2 mx-sm-3 text-white"})])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"d-block d-sm-none"},[e("i",{staticClass:"fas fa-arrow-left p-2 mr-2 text-white",staticStyle:{"font-size":"1.5rem",cursor:"pointer"},attrs:{onclick:"showChatList()"}})])},function(){var t=this.$createElement,e=this._self._c||t;return e("a",{attrs:{href:"#"}},[e("i",{staticClass:"fas fa-search mx-3 text-white d-none d-md-block"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("a",{attrs:{href:"#"}},[e("i",{staticClass:"fas fa-paperclip mx-3 text-white d-none d-md-block"})])},function(){var t=this.$createElement,e=this._self._c||t;return e("a",{attrs:{href:"#"}},[e("i",{staticClass:"fas fa-ellipsis-v mr-2 mx-sm-3 text-white"})])}],!1,null,null,null).exports,d=r(0),f={props:{message:{type:Object,required:!0}},computed:{user:function(){return this.$store.state.login.user}},data:function(){return{created_at:null}},mounted:function(){this.setSendAt(),setTimeout((function(){var t=document.getElementById("messages");t.scrollTop=t.scrollHeight}),300)},methods:{setSendAt:function(){var t=this;this.interval=setInterval((function(){var e=d(new Date),r=d(t.message.created_at),o=d.duration(e.diff(r)).asHours();o<=1?t.created_at=d(t.message.created_at).fromNow():o<=168?t.created_at=d(t.message.created_at).calendar():(t.created_at=d(t.message.created_at).format("llll"),clearInterval(t.interval))}),100)}}},v=Object(l.a)(f,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return t.user.id!=t.message.sender.id?r("div",{staticClass:"align-self-start p-1 my-1 mx-3 rounded bg-white shadow-sm message-item"},[t._m(0),t._v(" "),r("div",{staticClass:"d-flex flex-row"},[r("div",{staticClass:"body m-1 mr-2"},[t._v(t._s(t.message.message))]),t._v(" "),r("div",{staticClass:"time ml-auto small text-right flex-shrink-0 align-self-end text-muted",staticStyle:{width:"75px"}},[t._v("\n      "+t._s(t.created_at)+"\n    ")])])]):r("div",{staticClass:"align-self-end self p-1 my-1 mx-3 rounded bg-white shadow-sm message-item"},[t._m(1),t._v(" "),r("div",{staticClass:"d-flex flex-row"},[r("div",{staticClass:"body m-1 mr-2"},[t._v(t._s(t.message.message))]),t._v(" "),r("div",{staticClass:"time ml-auto small text-right flex-shrink-0 align-self-end text-muted",staticStyle:{width:"75px"}},[t._v("\n      "+t._s(t.created_at)+"\n    ")])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"options"},[e("a",{attrs:{href:"#"}},[e("i",{staticClass:"fas fa-angle-down text-muted px-2"})])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"options"},[e("a",{attrs:{href:"#"}},[e("i",{staticClass:"fas fa-angle-down text-muted px-2"})])])}],!1,null,null,null).exports,h={components:{Picker:r(336).Picker},computed:{room:function(){return this.$store.state.chat.activeRoom},user:function(){return this.$store.state.login.user}},methods:{select:function(t){var e=document.getElementById("input").value;document.getElementById("input").value=e+t.native},setEmoji:function(){document.getElementById("emojione").classList.remove("d-none"),document.getElementById("emojione").classList.add("d-flex")},sendMessage:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var element,form,r,o,n,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,element=document.getElementById("send-message"),form=new FormData(element),e.next=5,axios.post("rooms/".concat(t.room.id,"/message"),form);case 5:element.reset(),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),e.t0.response?422==e.t0.response.status?(r=e.t0.response.data.message,t.$notify({group:"foo",text:r,type:"error"})):401==e.t0.response.status?(o=e.t0.response.data.message,t.$notify({group:"foo",text:o,type:"error"}),$nuxt.$store.commit("login/logout",{})):400==e.t0.response.status?(n=e.t0.response.data.message,t.$notify({group:"foo",text:n,type:"error"})):(c=e.t0.response.data.statusText,t.$notify({group:"foo",text:c,type:"error"})):t.$notify({group:"foo",text:"No internet access",type:"error"});case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))()},typing:function(){document.getElementById("emojione").classList.remove("d-flex"),document.getElementById("emojione").classList.add("d-none"),Echo.private("chat-".concat(this.room.id)).whisper("typing",{user:this.user})}}},_={components:{senderNav:m,singleMessage:v,sendMessage:Object(l.a)(h,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("form",{attrs:{autocomplete:"off",id:"send-message"},on:{submit:function(e){return e.preventDefault(),t.sendMessage()}}},[r("picker",{staticClass:"d-none",staticStyle:{width:"100%"},attrs:{id:"emojione",set:"emojione"},on:{select:t.select}}),t._v(" "),r("div",{staticClass:"justify-self-end align-items-center flex-row d-flex",attrs:{id:"input-area"}},[r("a",{attrs:{href:"#"},on:{click:function(e){return t.setEmoji()}}},[r("i",{staticClass:"far fa-smile text-muted px-3",staticStyle:{"font-size":"1.5rem"}})]),t._v(" "),r("input",{staticClass:"flex-grow-1 border-0 px-3 py-2 my-3 rounded shadow-sm",attrs:{type:"text",name:"message",id:"input",placeholder:"Type a message"},on:{keypress:[function(e){return t.typing()},function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.sendMessage(e)}]}}),t._v(" "),r("i",{staticClass:"fas fa-paper-plane text-muted px-3",staticStyle:{cursor:"pointer"},on:{click:function(e){return e.preventDefault(),t.sendMessage(e)}}})])],1)}),[],!1,null,null,null).exports},computed:{messages:function(){return this.$store.state.chat.messages},activeRoom:function(){return this.$store.state.chat.activeRoom},mounted:function(){}}},x=Object(l.a)(_,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"d-none d-sm-flex flex-column col-12 col-sm-7 col-md-8 p-0 h-100",attrs:{id:"message-area"}},[t.activeRoom.id?t._e():r("div",{staticClass:"w-100 h-100 overlay d-flex align-items-center justify-content-center"},[r("h2",{staticClass:"text-capitalize"},[t._v("no message to show")])]),t._v(" "),r("sender-nav"),t._v(" "),r("div",{staticClass:"d-flex flex-column",attrs:{id:"messages"}},t._l(t.messages,(function(t,e){return r("single-message",{key:e,attrs:{message:t}})})),1),t._v(" "),r("send-message")],1)}),[],!1,null,null,null).exports,y=Object(l.a)({},(function(){var t=this.$createElement;this._self._c;return this._m(0)}),[function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"d-flex flex-column w-100 h-100",attrs:{id:"profile-settings"}},[r("div",{staticClass:"row d-flex flex-row align-items-center p-2 m-0",staticStyle:{background:"#009688","min-height":"65px"}},[r("i",{staticClass:"fas fa-arrow-left p-2 mx-3 my-1 text-white",staticStyle:{"font-size":"1.5rem",cursor:"pointer"},attrs:{onclick:"hideProfileSettings()"}}),t._v(" "),r("div",{staticClass:"text-white font-weight-bold"},[t._v("Profile")])]),t._v(" "),r("div",{staticClass:"d-flex flex-column",staticStyle:{overflow:"auto"}},[r("img",{staticClass:"img-fluid rounded-circle my-5 justify-self-center mx-auto",attrs:{alt:"Profile Photo",id:"profile-pic"}}),t._v(" "),r("input",{staticClass:"d-none",attrs:{type:"file",id:"profile-pic-input"}}),t._v(" "),r("div",{staticClass:"bg-white px-3 py-2"},[r("div",{staticClass:"text-muted mb-2"},[r("label",{attrs:{for:"input-name"}},[t._v("Your Name")])]),t._v(" "),r("input",{staticClass:"w-100 border-0 py-2 profile-input",attrs:{type:"text",name:"name",id:"input-name"}})]),t._v(" "),r("div",{staticClass:"text-muted p-3 small"},[t._v("\n      This is not your username or pin. This name will be visible to your\n      WhatsApp contacts.\n    ")]),t._v(" "),r("div",{staticClass:"bg-white px-3 py-2"},[r("div",{staticClass:"text-muted mb-2"},[r("label",{attrs:{for:"input-about"}},[t._v("About")])]),t._v(" "),r("input",{staticClass:"w-100 border-0 py-2 profile-input",attrs:{type:"text",name:"name",id:"input-about",value:""}})])])])}],!1,null,null,null).exports,w=r(0),C={props:{room:{type:Object,required:!0}},data:function(){return{created_at:null}},computed:{activeRoom:function(){return this.$store.state.chat.activeRoom},typing:function(){return this.$store.state.chat.typing}},mounted:function(){this.solveDate()},methods:{solveDate:function(){var t=this;this.interval=setInterval((function(){var e=w(new Date),r=w(t.room.message_send_at),o=w.duration(e.diff(r)).asHours();o<=1?t.created_at=w(t.room.message_send_at).fromNow():o<=168?t.created_at=w(t.room.message_send_at).calendar():(t.created_at=w(t.room.message_send_at).format("llll"),clearInterval(t.interval))}),100)},setActive:function(){return this.$emit("setActive",this.room)}}},k=Object(l.a)(C,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{class:"chat-list-item d-flex flex-row w-100 p-2 border-bottom "+(t.activeRoom&&t.activeRoom.id==t.room.id?"active":""),on:{click:function(e){return e.preventDefault(),t.setActive()}}},[r("img",{staticClass:"img-fluid rounded-circle mr-2",staticStyle:{height:"50px"},attrs:{src:t.room.room_image,alt:t.room.room_name}}),t._v(" "),r("div",{staticClass:"w-50"},[r("div",{staticClass:"name"},[t._v(t._s(t.room.room_name))]),t._v(" "),r("div",{staticClass:"small last-message"},[t._v("\n      "+t._s(t.typing&&t.activeRoom.id==t.room.id?t.typing:t.room.last_message)+"\n    ")])]),t._v(" "),r("div",{staticClass:"flex-grow-1 text-right"},[r("div",{staticClass:"small time"},[t._v(t._s(t.created_at))])])])}),[],!1,null,null,null).exports,E=r(0),R={components:{singleUser:k},computed:{rooms:function(){return this.$store.state.chat.rooms},activeRoom:function(){return this.$store.state.chat.activeRoom},user:function(){return this.$store.state.login.user}},methods:{solveDate:function(t){return E(t).calendar()},setActive:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var o,n,c,l;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.id!=e.activeRoom.id){r.next=2;break}return r.abrupt("return",!1);case 2:return r.prev=2,r.next=5,axios.get("/rooms/".concat(t.id));case 5:o=r.sent,e.leaveSocket(),n=o.data.messages,e.$store.commit("chat/setMessages",n),e.$store.commit("chat/setActive",t),e.openSocket(),r.next=17;break;case 13:r.prev=13,r.t0=r.catch(2),console.log(r.t0),r.t0.response?401==r.t0.response.status?(c=r.t0.response.data.message,e.$notify({group:"foo",text:c,type:"error"}),$nuxt.$store.commit("login/logout",{})):(l=r.t0.response.data.message,e.$notify({group:"foo",text:l,type:"error"})):e.$notify({group:"foo",text:"No internet access",type:"error"});case 17:case"end":return r.stop()}}),r,null,[[2,13]])})))()},openSocket:function(){var t=this;Echo.private("chat-".concat(this.activeRoom.id)).listen("NewMessage",(function(e){t.$store.commit("chat/addMessage",e.message)})).listenForWhisper("typing",(function(e){if(t.user.id!=e.user.id){var text="".concat(e.user.full_name," typing ...");t.$store.commit("chat/type",text),setTimeout((function(){t.$store.commit("chat/type",null)}),1e3)}}))},leaveSocket:function(){Echo.leave("chat-".concat(this.activeRoom.id))}}},j=Object(l.a)(R,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"row",staticStyle:{overflow:"auto"},attrs:{id:"chat-list"}},t._l(t.rooms,(function(e,o){return r("single-user",{key:o,attrs:{room:e},on:{setActive:t.setActive}})})),1)}),[],!1,null,null,null).exports,S={props:{users:{type:Array,required:!0}},methods:{selectUser:function(t){var e=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var o,n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,axios.post("/rooms/create",{user_id:t.id});case 3:$("#users-modal").modal("hide"),r.next=9;break;case 6:r.prev=6,r.t0=r.catch(0),r.t0.response?401==r.t0.response.status?(o=r.t0.response.data.message,e.$notify({group:"foo",text:o,type:"error"}),$nuxt.$store.commit("login/logout",{})):(n=r.t0.response.data.message,e.$notify({group:"foo",text:n,type:"error"})):e.$notify({group:"foo",text:"No internet access",type:"error"});case 9:case"end":return r.stop()}}),r,null,[[0,6]])})))()}}},A={components:{usersModal:Object(l.a)(S,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"modal fade",attrs:{role:"dialog",id:"users-modal",tabindex:"-1"}},[r("div",{staticClass:"modal-dialog"},[r("div",{staticClass:"modal-content"},[t._m(0),t._v(" "),r("div",{staticClass:"modal-body"},t._l(t.users,(function(e,o){return r("div",{key:o,staticClass:"m-2 shadow row card",on:{click:function(r){return t.selectUser(e)}}},[r("div",{staticClass:"justify-content-between col-12"},[e?r("img",{staticClass:"img-thumbnail",attrs:{src:e.profile_picture_url,width:"20%",alt:""}}):t._e(),t._v(" "),e?r("div",{staticClass:"d-inline"},[t._v(t._s(e.full_name))]):t._e()])])})),0)])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-header"},[e("h5",{staticClass:"modal-title"},[this._v("New chat")])])}],!1,null,null,null).exports},data:function(){return{users:[]}},computed:{user:function(){return this.$store.state.login.user}},methods:{logout:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,axios.post("/logout");case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:t.$store.commit("login/logout",{});case 8:case"end":return e.stop()}}),e,null,[[0,5]])})))()},getUsers:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,o,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,axios.get("/users");case 3:if(r=e.sent,t.users=r.data.users,0!=t.users.length){e.next=8;break}return t.$notify({group:"foo",text:"No users found",type:"error"}),e.abrupt("return",!1);case 8:$("#users-modal").modal("show"),e.next=15;break;case 11:e.prev=11,e.t0=e.catch(0),console.log(e.t0),e.t0.response?401==e.t0.response.status?(o=e.t0.response.data.message,t.$notify({group:"foo",text:o,type:"error"}),$nuxt.$store.commit("login/logout",{})):(n=e.t0.response.data.message,t.$notify({group:"foo",text:n,type:"error"})):t.$notify({group:"foo",text:"No internet access",type:"error"});case 15:case"end":return e.stop()}}),e,null,[[0,11]])})))()}}},O=Object(l.a)(A,(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"row d-flex flex-row align-items-center p-2",attrs:{id:"navbar"}},[t.user?r("img",{staticClass:"img-fluid rounded-circle mr-2",staticStyle:{height:"50px",cursor:"pointer"},attrs:{alt:"Profile Photo",onclick:"showProfileSettings()",id:"display-pic",src:t.user.profile_picture_url}}):t._e(),t._v(" "),t.user?r("div",{staticClass:"text-white font-weight-bold",attrs:{id:"username"}},[t._v("\n    "+t._s(t.user.full_name)+"\n  ")]):t._e(),t._v(" "),r("div",{staticClass:"nav-item dropdown ml-auto"},[r("users-modal",{attrs:{users:t.users}}),t._v(" "),t._m(0),t._v(" "),r("div",{staticClass:"dropdown-menu dropdown-menu-right"},[r("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.getUsers()}}},[t._v("New Chat")]),t._v(" "),r("a",{staticClass:"dropdown-item",attrs:{href:"#"}},[t._v("Archived")]),t._v(" "),r("a",{staticClass:"dropdown-item",attrs:{href:"#"}},[t._v("Starred")]),t._v(" "),r("a",{staticClass:"dropdown-item",attrs:{href:"#"}},[t._v("Settings")]),t._v(" "),r("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.logout(e)}}},[t._v("Log Out")])])],1)])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("a",{staticClass:"nav-link dropdown-toggle",attrs:{"data-toggle":"dropdown",href:"#",role:"button","aria-haspopup":"true","aria-expanded":"false"}},[e("i",{staticClass:"fas fa-ellipsis-v text-white"})])}],!1,null,null,null).exports,D=(r(255),r(0),{middleware:"auth",components:{messageArea:x,profileArea:y,chatArea:j,navArea:O},head:function(){return{}},mounted:function(){this.getRooms()},created:function(){var t=this;Echo.private("room-".concat(this.user.id)).listen("NewRoom",(function(e){t.$store.commit("chat/addRoom",e.room)})).listen("RoomUpdated",(function(e){t.$store.commit("chat/updateLastMessage",e.room)}))},computed:{user:function(){return this.$store.state.login.user}},methods:{getRooms:function(){var t=this;return Object(o.a)(regeneratorRuntime.mark((function e(){var r,o,n,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,axios.get("/rooms");case 3:r=e.sent,o=r.data.rooms,t.$store.commit("chat/createRooms",o),e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),e.t0.response?401==e.t0.response.status?(n=e.t0.response.data.message,t.$notify({group:"foo",text:n,type:"error"}),$nuxt.$store.commit("login/logout",{})):(c=e.t0.response.data.message,t.$notify({group:"foo",text:c,type:"error"})):t.$notify({group:"foo",text:"No internet access",type:"error"});case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))()}}}),N=Object(l.a)(D,(function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"container-fluid",attrs:{id:"main-container"}},[e("div",{staticClass:"row h-100"},[e("div",{staticClass:"col-12 col-sm-5 col-md-4 d-flex flex-column",staticStyle:{position:"relative"},attrs:{id:"chat-list-area"}},[e("nav-area"),this._v(" "),e("chat-area"),this._v(" "),e("profile-area")],1),this._v(" "),e("message-area")],1)])}),[],!1,null,null,null);e.default=N.exports}}]);